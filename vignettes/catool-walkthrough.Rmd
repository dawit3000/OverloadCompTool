---
title: "catool: Walkthrough"
output: rmarkdown::html_vignette
editor_options:
  chunk_output_type: console
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{catool: Walkthrough}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, include=FALSE}
library(catool)
library(dplyr)
```

## 🔍 Introduction

This vignette demonstrates how to use the `catool` R package to calculate fair and transparent overload compensation for college instructors, based on institutional course schedules and compensation policies.

The package supports analysis for both individual instructors and full teaching schedules using well-defined eligibility and proration rules based on enrollment and credit hour thresholds.

---

## 🏫 Prepare Your Schedule Data

To use `catool`, your schedule data must include at minimum:

* `INSTRUCTOR`: Instructor name (e.g., "Smith, John")
* `ENRLD`: Enrollment count for each course
* `HRS`: Credit hours for each course

📂 **Sample input**: 

The [`schedule.csv`](https://raw.githubusercontent.com/dawit3000/catool/master/inst/extdata/schedule.csv) file from the "inst/extdata" folder provides a realistic example of course schedule data used by the package. It includes columns such as `SUBJ`, `CRN`, `INSTRUCTOR`,`DEPARTMENT` and `COLLEGE` fields.


```{r, echo=TRUE, results="hide", eval = FALSE}
schedule <- data.frame(
  INSTRUCTOR = c("Lalau-Hitchcock, Diksha", "Lalau-Hitchcock, Diksha", "Smith, John"),
  ENRLD = c(12, 7, 4),
  HRS = c(3, 3, 3),
  stringsAsFactors = FALSE
)
```

If you have extended data including subject codes, departments, colleges, and programs, make sure those columns are labeled as `SUBJ`, `DEPARTMENT`, `COLLEGE`, and `PROGRAM` respectively.

---

## 🔎 Filter Schedules with `filter_schedule()`

You can filter a schedule using subject codes, instructor names, department, college, or program using pattern matching.

```{r, echo=TRUE, results="hide", warning=FALSE, eval = FALSE}
# Filter by subject pattern
filter_schedule(schedule, subject_pattern = "MATH|CSCI")

# Filter by instructor
filter_schedule(schedule, instructor_pattern = "aberra|zeng")

# Filter by department
filter_schedule(schedule, department_pattern = "Business Administration")

# Filter by college
filter_schedule(schedule, college_pattern = "arts")

# Filter by program
filter_schedule(schedule, program_pattern = "computation")
```

---

## 👤 Analyze One Instructor

```{r, echo=TRUE, results="hide", eval = FALSE}
# Filter by instructor name (case-insensitive)
inst_schedule <- get_instructor_schedule("Lalau-Hitchcock", schedule)

# Calculate overload compensation using default policy
ol_comp(inst_schedule)

# You can also apply custom policy parameters
ol_comp(inst_schedule, L = 4, U = 8, reg_load = 9, rate_per_cr = 5000 / 3)
```

---

## 👥 See All Instructors in the Schedule

```{r, echo=TRUE, results="hide", eval = FALSE}
get_unique_instructors(schedule)
```

---

## 🔢 Analyze by Instructor Index

```{r, echo=TRUE, results="hide", eval = FALSE}
# Get summary for a specific instructor by index
ol_comp_byindex(1, schedule_df = schedule)

# With custom policy
ol_comp_byindex(1, schedule_df = schedule, L = 4, U = 9, reg_load = 12, rate_per_cr = 2500 / 3)
```

---

## 📋 Summarize All Instructors

The `ol_comp_summary()` function generates a comprehensive compensation report for **all instructors** in the schedule.

**Purpose:**

- Aggregate overload pay calculations for payroll or administration.
- Enforce consistent application of institutional policy.

**Default usage:**

```{r, echo=TRUE, eval = FALSE}
ol_comp_summary(schedule)
```

**Custom policy parameters:**

```{r, echo=TRUE, eval = FALSE}
ol_comp_summary(schedule, L = 4, U = 9, reg_load = 12, rate_per_cr = 2500 / 3)
```

The output is formatted for easy import into Excel or use in administrative reports.

---

## 🧲 Explanation of Policy Rules

The overload compensation algorithm in **catool** reflects typical institutional policy logic designed to ensure fairness and consistency.

### 💡 Policy Parameters

* **`ENRLD`**: Course enrollment
* **`HRS`**: Credit hours per course
* **`reg_load`**: Regular teaching load (default = 12 credit hours)
* **`rate_per_cr`**: Compensation per qualified credit hour (default = 2500 / 3)

### ⚖️ Key Rules

1. **Qualified Credit Hours**
   Only credit hours exceeding the instructor’s regular load (`reg_load`) are eligible for overload pay.

2. **Enrollment-Based Eligibility**

   * Courses with `ENRLD < L` (default `L = 4`) are excluded from compensation.
   * If **enrollment corresponding to qualified credit hours is less than 10**, pay is **prorated**.
   * If **enrollment is 10 or more**, pay is awarded in full.

3. **Fair Distribution**

   * Courses are sorted by enrollment in **descending order**.
   * Qualified hours are counted from the **least-enrolled eligible course upward**, ensuring the most populated classes are taught as part of the regular load.
     This reflects standard policy assumptions: institutions prioritize assigning higher-impact (larger) courses to regular load, and identify overload from less-enrolled offerings.

---

## 📨 Questions?

For questions or feedback, please open a [GitHub issue](https://github.com/dawit3000/catool/issues)  
or contact **Dawit Aberra** at [aberrad@fvsu.edu](mailto:aberrad@fvsu.edu).
